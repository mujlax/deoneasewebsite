# Редактор новостей

## Текущее состояние (MVP)

- Блоки: параграф, заголовок H2, заголовок H3, встроенное изображение.
- Метаданные: заголовок, описание, дата, теги.
- Обложка: загрузка файла, хранение base64 в черновике, описание (alt-текст).
- Медиатека: загрузка нескольких inline-изображений, alt-тексты и управление.
- Предпросмотр: визуальный рендер блоков + сгенерированный MDX/JSON.
- Экспорт: скачивание `.draft.json` через браузерную загрузку.
- Управление порядком блоков (кнопки «вверх/вниз») внутри редактора.

## Архитектура

- Типы и утилиты в `src/pages/News/Editor` (`types.ts`, `utils.ts`).
- Состояние хранится в React с использованием `useState`.
- Сериализация добавляет `generatedAt` и `version` для отслеживания схемы.
- Черновик содержит массив `assets` (`cover`, `inline`) и ссылки на них из блоков.
- Скрипт `npm run content:sync` конвертирует черновики в MDX, сохраняет все ассеты и обновляет `index.json`.
- Предпросмотр в редакторе использует рендерер блоков, синхронизированный с генератором MDX.
- Секция «Редактировать существующую новость» подтягивает черновики из `src/content/news/drafts/_processed`.

## Бэклог

1. Поддержка блоков изображений и загрузка файлов в `public/news-assets`.
2. Генерация MDX и автоматическое обновление `index.json`. ✅ (scripts/sync-news.mjs)
3. История версий и режим предпросмотра MDX (расширить до «draft → published»).
4. Расширить редактор поддержкой комплексных блоков (галереи, цитаты) + drag & drop.
5. Валидация тегов (список, максимум 5 значений).
6. Управление порядком изображений и переиспользование ассетов между постами.
7. Связывание редактора с GitHub API для автоматического коммита (после согласования).

## Edge cases

- Минимум один блок сохраняется; удаление последнего блокирует экшен.
- Сохранение доступно только при заполненном заголовке и непустых блоках.
- При пустом заголовке используется slug `untitled`.
- Если файл обложки не загружен, скрипт пропускает генерацию cover.
- При повторной генерации скрипт перезаписывает существующий MDX и индекс.
- Если блок-ссылка на изображение потеряла ассет, блок остаётся в черновике, но игнорируется при генерации MDX.
